<?xml version="1.0" ?>

<Node name="root" gravity="0 0 0" dt="0.04">
	<RequiredPlugin name="cuda" pluginName="SofaCUDA" />
	<RequiredPlugin pluginName="MyPlugin" />

	<TestComponent 
		substeps="64" 
		pixel_skip_count="1" 
		max_spring_stiffness="1000" 
		max_data_distance="15" 
		stats_file="/home/students/haentsch/data/press_only_stats/0.stats"
		volume_prefix="/media/haentsch/data/BioSim/pig/" 
		surface_prefix="/media/haentsch/data/BioSim/pig/" 
		rgbd_prefix="/media/haentsch/data/BioSimCamera/schwein/rgbd/" 
		ground_truth_prefix="/home/students/haentsch/data2/BioSimCamera/deform_side_view/ground3d"
		polaris_folder="/media/haentsch/data/BioSimCamera/schwein"
		polaris_offset="920"
		verify="false"
		calibration="/home/students/haentsch/data/pig.calib"
		/>

	<Node name="data" gravity="0 0 0">
		<MechanicalObject template="CudaVec3f" name="dofs" />
	</Node>
	
    <Node name="liver" gravity="0 0 0">

    	<EulerImplicitSolver name="cg_odesolver"/>
		<CGLinearSolver name="linear solver" iterations="8" tolerance="1e-08" threshold="1e-08" />

		<MeshVTKLoader name="meshLoader" filename="/media/haentsch/data/BioSim/pig/0.vtk" />
        <TetrahedronSetTopologyContainer name="topo" src="@meshLoader" />
        <MechanicalObject template="CudaVec3f" name="dofs" src="@meshLoader" />
        <TetrahedronSetGeometryAlgorithms template="CudaVec3f" name="GeomAlgo" />
		<DiagonalMass  name="computed using mass density" massDensity="1" />

		<!--<TetrahedralCorotationalFEMForceField template="CudaVec3f" name="FEM" method="large" poissonRatio="0.4" youngModulus="3000" computeGlobalMatrix="0" />-->
		<!--<FastTetrahedralCorotationalForceField template="CudaVec3f" name="FEM" method="large" poissonRatio="0.4" youngModulus="3000" computeGlobalMatrix="0" />-->
		<!--<StandardTetrahedralFEMForceField template="CudaVec3f" name="FEM" method="large" poissonRatio="0.4" youngModulus="3000" computeGlobalMatrix="0" />-->
		<TetrahedronFEMForceField template="CudaVec3f" name="FEM" youngModulus="3000" poissonRatio="0.44" listening="true" />

		<Node name ="surface" gravity="0 0 0">
			<MeshSTLLoader name="surface_mesh_loader" filename="/media/haentsch/data/BioSim/pig/0.stl" />
        	<MechanicalObject template="CudaVec3f" name="dofs" src="@surface_mesh_loader" />
            <BarycentricMapping name="surface_mapping" input="@../dofs" output="@dofs" />
		</Node>

		<Node name="visual">
			<Mesh name="surface_mesh" filename="/media/haentsch/data/BioSim/pig/0.stl"/>
        	<MechanicalObject template="CudaVec3f" name="dofs"/>
			<CudaVisualModel template="CudaVec3f" name="cuda" computeNormals="true" diffuse="0.8 0.1 0.1 1.0" specular="0.5 0.5 0.5 1.0"/>
			<BarycentricMapping name="visual_mapping" input="@../dofs" output="@dofs" 
				isMechanical="false" />
		</Node>

        <Node name="visu" tags="Visual" gravity="0 0 0">
			<OglModel  name="VisualModel" fileMesh="/media/haentsch/data/BioSim/pig/0.stl" />
            <BarycentricMapping name="visual mapping" input="@../dofs" output="@VisualModel" />
			<OglModel  name="reference_model" fileMesh="/media/haentsch/data/BioSim/pig/0.stl" />
        </Node>
    </Node>

	<Node name="anchors" gravity="0 0 0">
		<MeshVTKLoader name="meshLoader" filename="/media/haentsch/data/BioSim/pig/0.vtk" />
		<MechanicalObject template="CudaVec3f" name="rest_spring_anchors" src="@meshLoader" />
	</Node>

	<MyCudaSpringForceField template="CudaVec3f" name="springs" object1="@./data/dofs" object2="@./liver/surface/dofs" />
	<MyCudaSpringForceField template="CudaVec3f" name="rest_springs" object1="@./anchors/rest_spring_anchors" object2="@./liver/dofs" />
	<MeshVTKLoader name="vtk_loader" filename="/media/haentsch/data/BioSim/pig/0.vtk" />
</Node>
